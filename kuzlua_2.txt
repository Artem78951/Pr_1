local date1 = {
    data = {},   
    passage = {},     
    original = {}     
}

function parseDate(str)
    local year, month, day = string.match(str, "(%d+)-(%d+)-(%d+)")
    if not year then return nil end
    return os.time({ year = tonumber(year), month = tonumber(month), day = tonumber(day), hour = 0 })
end

function date1.extract(car_list)
    date1.data = {}
    date1.passage = {}
    date1.original = {}

    for _, item in ipairs(car_list) do
        local date_str, plate = string.match(item, "^(%S+)%s+(%S+)")
        if date_str and plate then
            local time_val = parseDate(date_str)
            if time_val then
                table.insert(date1.data, time_val)
                table.insert(date1.passage, plate)
                table.insert(date1.original, item)
            else
                print("неверный формат даты в строке: ", item)
            end
        else
            print("неверный формат строки: ", item)
        end
    end
end

function date1.sortByDate()
    local indices = {}
    for i = 1, #date1.data do
        indices[i] = i
    end

    table.sort(indices, function(a, b)
        return date1.data[a] < date1.data[b]
    end)

    date1._applyIndices(indices)
end

function date1.sortByPlateLetter()
    local indices = {}
    for i = 1, #date1.passage do
        indices[i] = i
    end

    table.sort(indices, function(a, b)
        local letterA = string.sub(date1.passage[a], 1, 1):upper()
        local letterB = string.sub(date1.passage[b], 1, 1):upper()
        return letterA < letterB
    end)

    date1._applyIndices(indices)
end

-- Вспомогательная функция: переставляет все три массива по списку индексов
function date1._applyIndices(indices)
    local new_data = {}
    local new_passage = {}
    local new_original = {}

    for _, idx in ipairs(indices) do
        table.insert(new_data, date1.data[idx])
        table.insert(new_passage, date1.passage[idx])
        table.insert(new_original, date1.original[idx])
    end

    date1.data = new_data
    date1.passage = new_passage
    date1.original = new_original
end

function date1.print()
    for i = 1, #date1.data do
        local readable_date = os.date("%Y-%m-%d", date1.data[i])
        print(readable_date, date1.passage[i])
    end
end

-- Основная логика
local car_infos = {
    "2001-11-12 A000BC",
    "2004-03-10 E003EK",
    "2003-03-10 K009VO",
    "2005-03-10 K009VO",
    "2000-03-10 K009VO",
    "2000-03-15 K009VO",
    "2000-03-11 K009VO"
}

date1.extract(car_infos)

-- Запрос у пользователя
print("Выберите способ сортировки:")
print("1 - по дате")
print("2 - по первой букве номерного знака")
io.write("Ваш выбор: ")
local choice = io.read("*l")

if choice == "1" then
    date1.sortByDate()
elseif choice == "2" then
    date1.sortByPlateLetter()
else
    print("Неверный выбор. Используется сортировка по дате по умолчанию.")
    date1.sortByDate()
end

date1.print()
